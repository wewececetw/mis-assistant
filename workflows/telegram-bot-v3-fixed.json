{
  "name": "Telegram Bot V3",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"]
      },
      "id": "tg-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [240, 400],
      "webhookId": "tg-v3",
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const msg = $input.first().json.message;\nconst chatId = msg?.chat?.id || '';\nconst text = (msg?.text || '').trim();\nconst voice = msg?.voice || msg?.audio || msg?.video_note;\nconst voiceFileId = voice?.file_id || '';\nconst duration = voice?.duration || 0;\n\n// Voice message\nif (voiceFileId) {\n  return [{ json: { action: 'voice', chatId, voiceFileId, duration } }];\n}\n\n// Commands\nif (text.startsWith('/')) {\n  const cmd = text.substring(1).split(/[@\\s]/)[0].toLowerCase();\n  const replies = {\n    start: 'ğŸ¤– MIS è‡ªå‹•åŒ–åŠ©ç†\\n\\nå¯ç”¨æŒ‡ä»¤ï¼š\\n/status - å®¹å™¨ç‹€æ…‹\\n/meeting - æœƒè­°è¨˜éŒ„èªªæ˜\\n/news - ç§‘æŠ€æ–°èï¼ˆç¹ä¸­ï¼‰\\n/help - å®Œæ•´èªªæ˜\\n\\nğŸ¤ ç›´æ¥ç™¼èªéŸ³ = AI æœƒè­°è¨˜éŒ„\\nğŸ“ ç›´æ¥è²¼æ–‡å­— = AI æ‘˜è¦',\n    help: 'â“ ä½¿ç”¨èªªæ˜\\n\\nâ”â”â”â” æœƒè­°è¨˜éŒ„ â”â”â”â”\\nğŸ¤ èªéŸ³ï¼šç›´æ¥ç™¼é€èªéŸ³è¨Šæ¯\\nğŸ“ æ–‡å­—ï¼šç›´æ¥è²¼ä¸Šæœƒè­°æ–‡å­—ï¼ˆ>20å­—ï¼‰\\nâ†’ AI è‡ªå‹•ç”¢ç”Ÿçµæ§‹åŒ–æ‘˜è¦\\n\\nâ”â”â”â” æŒ‡ä»¤åˆ—è¡¨ â”â”â”â”\\n/status - Docker å®¹å™¨ç‹€æ…‹\\n/meeting - æœƒè­°è¨˜éŒ„åŠŸèƒ½èªªæ˜\\n/news - ä»Šæ—¥ç§‘æŠ€æ–°èï¼ˆç¹ä¸­ç¿»è­¯ï¼‰\\n/help - é¡¯ç¤ºæœ¬èªªæ˜\\n\\nâš ï¸ èªéŸ³é™åˆ¶ï¼šç›®å‰åƒ…æ”¯æ´ < 20MB',\n    meeting: 'ğŸ“ æœƒè­°è¨˜éŒ„åŠŸèƒ½\\n\\nä½¿ç”¨æ–¹å¼ï¼š\\n1ï¸âƒ£ èªéŸ³ï¼šç›´æ¥ç™¼é€èªéŸ³è¨Šæ¯\\n2ï¸âƒ£ æ–‡å­—ï¼šç›´æ¥è²¼ä¸Šæœƒè­°æ–‡å­—ï¼ˆ>20å­—ï¼‰\\n\\nBot æœƒè‡ªå‹•ï¼š\\nâ€¢ èªéŸ³è½‰æ–‡å­—ï¼ˆWhisperï¼‰\\nâ€¢ AI ç”¢ç”Ÿçµæ§‹åŒ–æ‘˜è¦\\nâ€¢ æå–æ±ºè­°ã€å¾…è¾¦ã€è² è²¬äºº\\n\\nâ± è™•ç†æ™‚é–“ç´„ 20-60 ç§’\\nâš ï¸ èªéŸ³é™åˆ¶ï¼šç›®å‰åƒ…æ”¯æ´ < 20MB'\n  };\n  if (replies[cmd]) {\n    return [{ json: { action: 'reply', chatId, message: replies[cmd] } }];\n  }\n  // status / news - pass through\n  return [{ json: { action: cmd, chatId, text } }];\n}\n\n// Plain text - treat as meeting notes\nif (text.length > 20) {\n  return [{ json: { action: 'text-meeting', chatId, text } }];\n}\n\nreturn [{ json: { action: 'reply', chatId, message: 'ğŸ’¡ ç™¼é€èªéŸ³è¨Šæ¯å¯è‡ªå‹•ç”¢ç”Ÿæœƒè­°è¨˜éŒ„\\næˆ–è¼¸å…¥ /help æŸ¥çœ‹èªªæ˜' } }];"
      },
      "id": "router",
      "name": "Router",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true },
          "conditions": [
            {
              "id": "c1",
              "leftValue": "={{ $json.action }}",
              "rightValue": "reply",
              "operator": { "type": "string", "operation": "equals" }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "is-reply",
      "name": "Is Reply?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [680, 400]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}"
      },
      "id": "send-reply",
      "name": "Send Reply",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [900, 300],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true },
          "conditions": [
            {
              "id": "c2",
              "leftValue": "={{ $json.action }}",
              "rightValue": "voice",
              "operator": { "type": "string", "operation": "equals" }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "is-voice",
      "name": "Is Voice?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [900, 500]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "ğŸ¤ èªéŸ³è™•ç†ä¸­...\nâ³ è«‹ç¨å€™ 20-60 ç§’\n\n1ï¸âƒ£ ä¸‹è¼‰èªéŸ³\n2ï¸âƒ£ è½‰æª”å£“ç¸®\n3ï¸âƒ£ èªéŸ³è½‰æ–‡å­—\n4ï¸âƒ£ AI æ‘˜è¦"
      },
      "id": "voice-ack",
      "name": "Voice Ack",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [1120, 500],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $env.TELEGRAM_BOT_TOKEN }}/getFile?file_id={{ $('Router').first().json.voiceFileId }}",
        "options": {}
      },
      "id": "get-file-info",
      "name": "Get File Info",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1340, 500]
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/file/bot{{ $env.TELEGRAM_BOT_TOKEN }}/{{ $json.result.file_path }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "id": "download-voice",
      "name": "Download Voice",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1560, 500]
    },
    {
      "parameters": {
        "fileName": "/tmp/voice_input.oga"
      },
      "id": "save-voice",
      "name": "Save Voice",
      "type": "n8n-nodes-base.writeBinaryFile",
      "typeVersion": 1,
      "position": [1780, 500]
    },
    {
      "parameters": {
        "jsCode": "const { execSync } = require('child_process');\nconst fs = require('fs');\nconst chatId = $('Router').first().json.chatId;\nconst duration = $('Router').first().json.duration || 0;\n\n// Convert OGA to MP3\nexecSync('ffmpeg -y -i /tmp/voice_input.oga -ar 16000 -ac 1 -b:a 32k /tmp/voice_converted.mp3', { timeout: 60000 });\n\nconst stats = fs.statSync('/tmp/voice_converted.mp3');\nconst fileSize = stats.size;\n\n// Decide whether to split\nlet segments = 1;\nif (fileSize > 20000000 || duration > 600) {\n  segments = Math.ceil(duration / 300);\n  for (let i = 0; i < segments; i++) {\n    const start = i * 300;\n    execSync(`ffmpeg -y -i /tmp/voice_converted.mp3 -ss ${start} -t 300 -ar 16000 -ac 1 -b:a 32k /tmp/voice_part_${i}.mp3`, { timeout: 60000 });\n  }\n} else {\n  fs.copyFileSync('/tmp/voice_converted.mp3', '/tmp/voice_part_0.mp3');\n}\n\nconst files = [];\nfor (let i = 0; i < segments; i++) {\n  files.push({ json: { filePath: `/tmp/voice_part_${i}.mp3`, partIndex: i, totalParts: segments, chatId } });\n}\nreturn files;"
      },
      "id": "convert-split",
      "name": "Convert & Split",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2000, 500]
    },
    {
      "parameters": {
        "jsCode": "const fs = require('fs');\nconst filePath = $input.first().json.filePath;\nconst partIndex = $input.first().json.partIndex;\nconst totalParts = $input.first().json.totalParts;\nconst chatId = $input.first().json.chatId;\n\nconst fileBuffer = fs.readFileSync(filePath);\nconst base64 = fileBuffer.toString('base64');\n\nreturn [{\n  json: { partIndex, totalParts, chatId },\n  binary: {\n    data: {\n      data: base64,\n      mimeType: 'audio/mpeg',\n      fileName: `voice_part_${partIndex}.mp3`\n    }\n  }\n}];"
      },
      "id": "read-audio-file",
      "name": "Read Audio File",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2440, 500]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/audio/transcriptions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "file",
              "parameterType": "formBinaryData",
              "inputDataFieldName": "data"
            },
            {
              "name": "model",
              "value": "whisper-large-v3"
            },
            {
              "name": "language",
              "value": "zh"
            }
          ]
        },
        "options": {}
      },
      "id": "whisper-transcribe",
      "name": "Whisper Transcribe",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2660, 500],
      "credentials": {
        "httpHeaderAuth": {
          "id": "06uVsarrbPv5XTZf",
          "name": "Groq API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Collect all transcription results\nconst items = $input.all();\nconst chatId = items[0]?.json?.chatId || $('Router').first().json.chatId;\n\n// Sort by part index and combine text\nconst parts = items.map((item, idx) => ({\n  index: item.json.partIndex || idx,\n  text: item.json.text || ''\n}));\nparts.sort((a, b) => a.index - b.index);\n\nconst fullText = parts.map(p => p.text).join('\\n').trim();\n\nif (!fullText || fullText.length < 5) {\n  return [{ json: { ok: false, chatId, error: 'èªéŸ³å…§å®¹å¤ªçŸ­æˆ–ç„¡æ³•è¾¨è­˜' } }];\n}\n\nconst prompt = `ä½ æ˜¯å°ˆæ¥­çš„æœƒè­°è¨˜éŒ„åŠ©ç†ã€‚è«‹åˆ†æä»¥ä¸‹èªéŸ³è½‰æ–‡å­—å…§å®¹ï¼Œä»¥ç¹é«”ä¸­æ–‡ç”¢ç”Ÿçµæ§‹åŒ–çš„æœƒè­°æ‘˜è¦ã€‚\n\nè«‹åŒ…å«ï¼š\nğŸ“Œ ä¸»é¡Œï¼ˆ1å¥è©±ï¼‰\nğŸ“‹ é‡é»æ‘˜è¦ï¼ˆ3-5é»ï¼‰\nâœ… æ±ºè­°äº‹é …\nğŸ“ å¾…è¾¦äº‹é …ï¼ˆå«è² è²¬äººï¼Œå¦‚æœ‰æåŠï¼‰\nâ° ä¸‹æ¬¡æœƒè­°/å¾ŒçºŒè¡Œå‹•ï¼ˆå¦‚æœ‰æåŠï¼‰\n\nèªéŸ³å…§å®¹ï¼š\n${fullText}`;\n\nreturn [{ json: { ok: true, chatId, fullText, prompt } }];"
      },
      "id": "merge-transcripts",
      "name": "Merge Transcripts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2880, 500]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true },
          "conditions": [
            {
              "id": "c3",
              "leftValue": "={{ $json.ok }}",
              "rightValue": true,
              "operator": { "type": "boolean", "operation": "equals" }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "transcript-ok",
      "name": "Transcript OK?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [3100, 500]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ model: 'llama-3.3-70b-versatile', messages: [{ role: 'user', content: $json.prompt }], temperature: 0.3, max_tokens: 1500 }) }}",
        "options": {}
      },
      "id": "ai-summarize",
      "name": "AI Summarize",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [3320, 440],
      "credentials": {
        "httpHeaderAuth": {
          "id": "06uVsarrbPv5XTZf",
          "name": "Groq API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const chatId = $('Merge Transcripts').first().json.chatId;\nconst fullText = $('Merge Transcripts').first().json.fullText;\nlet summary = $input.first().json?.choices?.[0]?.message?.content || 'æ‘˜è¦ç”¢ç”Ÿå¤±æ•—';\n\n// Clean markdown for Telegram\nsummary = summary.replace(/\\*\\*/g, '').replace(/\\*/g, '').replace(/###?\\s?/g, '').replace(/---/g, 'â”â”â”â”â”â”â”â”');\n\nconst textPreview = fullText.length > 80 ? fullText.substring(0, 80) + '...' : fullText;\n\nconst msg = 'ğŸ¤– AI æœƒè­°è¨˜éŒ„\\nâ”â”â”â”â”â”â”â”\\n\\n' + summary + '\\n\\nâ”â”â”â”â”â”â”â”\\nğŸ“ åŸå§‹èªéŸ³æ–‡å­—ï¼š\\n' + textPreview;\n\nreturn [{ json: { chatId, message: msg } }];"
      },
      "id": "format-result",
      "name": "Format Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3540, 440]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}"
      },
      "id": "send-result",
      "name": "Send Result",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [3760, 440],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const chatId = $('Merge Transcripts').first().json?.chatId || $('Router').first().json.chatId;\nconst error = $('Merge Transcripts').first().json?.error || 'èªéŸ³è™•ç†å¤±æ•—';\nreturn [{ json: { chatId, message: 'âŒ ' + error + '\\n\\nè«‹é‡æ–°éŒ„è£½æ¸…æ™°èªéŸ³å†è©¦ä¸€æ¬¡' } }];"
      },
      "id": "voice-error",
      "name": "Voice Error",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3320, 600]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}"
      },
      "id": "send-error",
      "name": "Send Error",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [3540, 600],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true },
          "conditions": [
            {
              "id": "c4",
              "leftValue": "={{ $json.action }}",
              "rightValue": "text-meeting",
              "operator": { "type": "string", "operation": "equals" }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "is-text-meeting",
      "name": "Is Text Meeting?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [900, 700]
    },
    {
      "parameters": {
        "jsCode": "const chatId = $input.first().json.chatId;\nconst text = $input.first().json.text;\n\nconst prompt = `ä½ æ˜¯å°ˆæ¥­çš„æœƒè­°è¨˜éŒ„åŠ©ç†ã€‚è«‹åˆ†æä»¥ä¸‹æœƒè­°è¨˜éŒ„æ–‡å­—ï¼Œä»¥ç¹é«”ä¸­æ–‡ç”¢ç”Ÿçµæ§‹åŒ–çš„æœƒè­°æ‘˜è¦ã€‚\n\nè«‹åŒ…å«ï¼š\nğŸ“Œ ä¸»é¡Œï¼ˆ1å¥è©±ï¼‰\nğŸ“‹ é‡é»æ‘˜è¦ï¼ˆ3-5é»ï¼‰\nâœ… æ±ºè­°äº‹é …\nğŸ“ å¾…è¾¦äº‹é …ï¼ˆå«è² è²¬äººï¼Œå¦‚æœ‰æåŠï¼‰\nâ° ä¸‹æ¬¡æœƒè­°/å¾ŒçºŒè¡Œå‹•ï¼ˆå¦‚æœ‰æåŠï¼‰\n\næœƒè­°è¨˜éŒ„ï¼š\n${text}`;\n\nreturn [{ json: { chatId, text, prompt } }];"
      },
      "id": "prep-text-meeting",
      "name": "Prep Text Meeting",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 700]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ model: 'llama-3.3-70b-versatile', messages: [{ role: 'user', content: $json.prompt }], temperature: 0.3, max_tokens: 1500 }) }}",
        "options": {}
      },
      "id": "ai-text-meeting",
      "name": "AI Text Meeting",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1340, 700],
      "credentials": {
        "httpHeaderAuth": {
          "id": "06uVsarrbPv5XTZf",
          "name": "Groq API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const chatId = $('Prep Text Meeting').first().json.chatId;\nlet summary = $input.first().json?.choices?.[0]?.message?.content || 'æ‘˜è¦ç”¢ç”Ÿå¤±æ•—';\nsummary = summary.replace(/\\*\\*/g, '').replace(/\\*/g, '').replace(/###?\\s?/g, '').replace(/---/g, 'â”â”â”â”â”â”â”â”');\nconst msg = 'ğŸ¤– AI æœƒè­°è¨˜éŒ„\\nâ”â”â”â”â”â”â”â”\\n\\n' + summary;\nreturn [{ json: { chatId, message: msg } }];"
      },
      "id": "format-text-meeting",
      "name": "Format Text Meeting",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1560, 700]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}"
      },
      "id": "send-text-meeting",
      "name": "Send Text Meeting",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [1780, 700],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true },
          "conditions": [
            {
              "id": "c5",
              "leftValue": "={{ $json.action }}",
              "rightValue": "status",
              "operator": { "type": "string", "operation": "equals" }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "is-status",
      "name": "Is Status?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [900, 900]
    },
    {
      "parameters": {
        "url": "http://docker-api-proxy:2375/containers/json?all=true",
        "options": {}
      },
      "id": "get-containers",
      "name": "Get Containers",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1120, 900]
    },
    {
      "parameters": {
        "jsCode": "const containers = $input.all().map(i => i.json);\nconst chatId = $('Router').first().json.chatId;\nconst running = containers.filter(c => c.State === 'running');\n\nlet msg = 'ğŸ³ Docker å®¹å™¨ç‹€æ…‹\\nâ”â”â”â”â”â”â”â”\\n';\nmsg += `ğŸ“Š ${running.length}/${containers.length} é‹è¡Œä¸­\\n\\n`;\n\nfor (const c of containers) {\n  const name = (c.Names && c.Names[0]) ? c.Names[0].replace('/', '') : 'unknown';\n  const icon = c.State === 'running' ? 'âœ…' : 'âŒ';\n  msg += `${icon} ${name} (${c.Status})\\n`;\n}\n\nmsg += `\\nâ° ${new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' })}`;\nreturn [{ json: { chatId, message: msg } }];"
      },
      "id": "format-status",
      "name": "Format Status",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1340, 900]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}"
      },
      "id": "send-status",
      "name": "Send Status",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [1560, 900],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true },
          "conditions": [
            {
              "id": "c6",
              "leftValue": "={{ $json.action }}",
              "rightValue": "news",
              "operator": { "type": "string", "operation": "equals" }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "is-news",
      "name": "Is News?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [900, 1100]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "ğŸ“° æ­£åœ¨æŠ“å–ç§‘æŠ€æ–°è...\nâ³ è«‹ç¨å€™ 30-60 ç§’\n\n1ï¸âƒ£ æŠ“å– RSS\n2ï¸âƒ£ AI ç¿»è­¯æˆç¹ä¸­\n3ï¸âƒ£ æ•´ç†æ‘˜è¦"
      },
      "id": "news-ack",
      "name": "News Ack",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [1120, 1100],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "url": "https://techcrunch.com/feed/",
        "options": {}
      },
      "id": "fetch-techcrunch",
      "name": "Fetch TechCrunch",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [1340, 1000]
    },
    {
      "parameters": {
        "url": "https://www.theverge.com/rss/index.xml",
        "options": {}
      },
      "id": "fetch-theverge",
      "name": "Fetch The Verge",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [1340, 1100]
    },
    {
      "parameters": {
        "url": "https://hnrss.org/frontpage",
        "options": {}
      },
      "id": "fetch-hackernews",
      "name": "Fetch Hacker News",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [1340, 1200]
    },
    {
      "parameters": {
        "jsCode": "const allItems = $input.all();\nconst chatId = $('Router').first().json.chatId;\nconst now = new Date();\nconst oneDayAgo = new Date(now - 24 * 60 * 60 * 1000);\n\nlet articles = [];\nallItems.forEach(item => {\n  if (item.json.title) {\n    const pubDate = item.json.pubDate ? new Date(item.json.pubDate) : now;\n    if (pubDate >= oneDayAgo) {\n      articles.push({\n        title: item.json.title,\n        link: item.json.link,\n        description: (item.json.description || item.json.contentSnippet || '').substring(0, 200)\n      });\n    }\n  }\n});\n\narticles = articles.slice(0, 5);\n\nconst newsText = articles.map((a, i) => `${i+1}. ${a.title}\\n${a.description}`).join('\\n\\n');\n\nconst prompt = `ä½ æ˜¯ç§‘æŠ€æ–°èç¿»è­¯åŠ©æ‰‹ã€‚è«‹å°‡ä»¥ä¸‹è‹±æ–‡ç§‘æŠ€æ–°èç¿»è­¯æˆç¹é«”ä¸­æ–‡ï¼Œä¸¦ç‚ºæ¯å‰‡æ–°èç”¢ç”Ÿç°¡çŸ­æ‘˜è¦ï¼ˆ1-2å¥ï¼‰ã€‚\n\næ ¼å¼ï¼š\nğŸ“° [ç¹ä¸­æ¨™é¡Œ]\nğŸ“ [1-2å¥æ‘˜è¦]\nğŸ·ï¸ [é¡åˆ¥: AI/ç¡¬é«”/è»Ÿé«”/å…¶ä»–]\n\næ–°èï¼š\n${newsText}`;\n\nreturn [{ json: { chatId, articles, prompt } }];"
      },
      "id": "merge-news",
      "name": "Merge News",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1560, 1100]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ model: 'llama-3.3-70b-versatile', messages: [{ role: 'user', content: $json.prompt }], temperature: 0.5, max_tokens: 2000 }) }}",
        "options": {}
      },
      "id": "ai-translate-news",
      "name": "AI Translate News",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1780, 1100],
      "credentials": {
        "httpHeaderAuth": {
          "id": "06uVsarrbPv5XTZf",
          "name": "Groq API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const chatId = $('Merge News').first().json.chatId;\nconst articles = $('Merge News').first().json.articles;\nlet translated = $input.first().json?.choices?.[0]?.message?.content || '';\n\ntranslated = translated.replace(/\\*\\*/g, '').replace(/\\*/g, '').replace(/###?\\s?/g, '');\n\nconst today = new Date().toISOString().split('T')[0];\nlet msg = `ğŸ—“ï¸ ${today} ç§‘æŠ€æ–°èæ‘˜è¦\\nâ”â”â”â”â”â”â”â”\\n\\n`;\nmsg += translated;\nmsg += `\\n\\nâ”â”â”â”â”â”â”â”\\n`;\nmsg += `ğŸ”— ä¾†æºé€£çµï¼š\\n`;\narticles.forEach((a, i) => {\n  msg += `${i+1}. ${a.link}\\n`;\n});\nmsg += `\\nâ° ${new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' })}`;\n\nreturn [{ json: { chatId, message: msg } }];"
      },
      "id": "format-news",
      "name": "Format News",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2000, 1100]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}"
      },
      "id": "send-news",
      "name": "Send News",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [2220, 1100],
      "credentials": {
        "telegramApi": {
          "id": "XfuqkzOYYEa0ar0n",
          "name": "Telegram Bot"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [[{ "node": "Router", "type": "main", "index": 0 }]]
    },
    "Router": {
      "main": [[{ "node": "Is Reply?", "type": "main", "index": 0 }]]
    },
    "Is Reply?": {
      "main": [
        [{ "node": "Send Reply", "type": "main", "index": 0 }],
        [{ "node": "Is Voice?", "type": "main", "index": 0 }]
      ]
    },
    "Is Voice?": {
      "main": [
        [{ "node": "Voice Ack", "type": "main", "index": 0 }],
        [{ "node": "Is Text Meeting?", "type": "main", "index": 0 }]
      ]
    },
    "Voice Ack": {
      "main": [[{ "node": "Get File Info", "type": "main", "index": 0 }]]
    },
    "Get File Info": {
      "main": [[{ "node": "Download Voice", "type": "main", "index": 0 }]]
    },
    "Download Voice": {
      "main": [[{ "node": "Save Voice", "type": "main", "index": 0 }]]
    },
    "Save Voice": {
      "main": [[{ "node": "Convert & Split", "type": "main", "index": 0 }]]
    },
    "Convert & Split": {
      "main": [[{ "node": "Read Audio File", "type": "main", "index": 0 }]]
    },
    "Read Audio File": {
      "main": [[{ "node": "Whisper Transcribe", "type": "main", "index": 0 }]]
    },
    "Whisper Transcribe": {
      "main": [[{ "node": "Merge Transcripts", "type": "main", "index": 0 }]]
    },
    "Merge Transcripts": {
      "main": [[{ "node": "Transcript OK?", "type": "main", "index": 0 }]]
    },
    "Transcript OK?": {
      "main": [
        [{ "node": "AI Summarize", "type": "main", "index": 0 }],
        [{ "node": "Voice Error", "type": "main", "index": 0 }]
      ]
    },
    "AI Summarize": {
      "main": [[{ "node": "Format Result", "type": "main", "index": 0 }]]
    },
    "Format Result": {
      "main": [[{ "node": "Send Result", "type": "main", "index": 0 }]]
    },
    "Voice Error": {
      "main": [[{ "node": "Send Error", "type": "main", "index": 0 }]]
    },
    "Is Text Meeting?": {
      "main": [
        [{ "node": "Prep Text Meeting", "type": "main", "index": 0 }],
        [{ "node": "Is Status?", "type": "main", "index": 0 }]
      ]
    },
    "Prep Text Meeting": {
      "main": [[{ "node": "AI Text Meeting", "type": "main", "index": 0 }]]
    },
    "AI Text Meeting": {
      "main": [[{ "node": "Format Text Meeting", "type": "main", "index": 0 }]]
    },
    "Format Text Meeting": {
      "main": [[{ "node": "Send Text Meeting", "type": "main", "index": 0 }]]
    },
    "Is Status?": {
      "main": [
        [{ "node": "Get Containers", "type": "main", "index": 0 }],
        [{ "node": "Is News?", "type": "main", "index": 0 }]
      ]
    },
    "Is News?": {
      "main": [
        [{ "node": "News Ack", "type": "main", "index": 0 }],
        []
      ]
    },
    "News Ack": {
      "main": [[{ "node": "Fetch TechCrunch", "type": "main", "index": 0 }, { "node": "Fetch The Verge", "type": "main", "index": 0 }, { "node": "Fetch Hacker News", "type": "main", "index": 0 }]]
    },
    "Fetch TechCrunch": {
      "main": [[{ "node": "Merge News", "type": "main", "index": 0 }]]
    },
    "Fetch The Verge": {
      "main": [[{ "node": "Merge News", "type": "main", "index": 0 }]]
    },
    "Fetch Hacker News": {
      "main": [[{ "node": "Merge News", "type": "main", "index": 0 }]]
    },
    "Merge News": {
      "main": [[{ "node": "AI Translate News", "type": "main", "index": 0 }]]
    },
    "AI Translate News": {
      "main": [[{ "node": "Format News", "type": "main", "index": 0 }]]
    },
    "Format News": {
      "main": [[{ "node": "Send News", "type": "main", "index": 0 }]]
    },
    "Get Containers": {
      "main": [[{ "node": "Format Status", "type": "main", "index": 0 }]]
    },
    "Format Status": {
      "main": [[{ "node": "Send Status", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" }
}
